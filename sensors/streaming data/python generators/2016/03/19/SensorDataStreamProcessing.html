<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Merging Sensor Data Streams with Python Generators and Priority Queues | The Abacus and the Canvas</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Merging Sensor Data Streams with Python Generators and Priority Queues" />
<meta name="author" content="Luca Cazzanti" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="How I used Python generators to process streaming data from maritime sensors." />
<meta property="og:description" content="How I used Python generators to process streaming data from maritime sensors." />
<link rel="canonical" href="https://lucacazzanti.github.io/abacus-canvas/sensors/streaming%20data/python%20generators/2016/03/19/SensorDataStreamProcessing.html" />
<meta property="og:url" content="https://lucacazzanti.github.io/abacus-canvas/sensors/streaming%20data/python%20generators/2016/03/19/SensorDataStreamProcessing.html" />
<meta property="og:site_name" content="The Abacus and the Canvas" />
<meta property="og:image" content="https://lucacazzanti.github.io/abacus-canvas/images/sensors_example.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-03-19T00:00:00-05:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://lucacazzanti.github.io/abacus-canvas/images/sensors_example.png" />
<meta property="twitter:title" content="Merging Sensor Data Streams with Python Generators and Priority Queues" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Luca Cazzanti"},"dateModified":"2016-03-19T00:00:00-05:00","datePublished":"2016-03-19T00:00:00-05:00","description":"How I used Python generators to process streaming data from maritime sensors.","headline":"Merging Sensor Data Streams with Python Generators and Priority Queues","image":"https://lucacazzanti.github.io/abacus-canvas/images/sensors_example.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://lucacazzanti.github.io/abacus-canvas/sensors/streaming%20data/python%20generators/2016/03/19/SensorDataStreamProcessing.html"},"url":"https://lucacazzanti.github.io/abacus-canvas/sensors/streaming%20data/python%20generators/2016/03/19/SensorDataStreamProcessing.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/abacus-canvas/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://lucacazzanti.github.io/abacus-canvas/feed.xml" title="The Abacus and the Canvas" /><!-- the google_analytics_id gets auto inserted from the config file -->



<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-4233318-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-4233318-1');
</script>


<link rel="shortcut icon" type="image/x-icon" href="/abacus-canvas/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/abacus-canvas/">The Abacus and the Canvas</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/abacus-canvas/about/">Luca Cazzanti, Ph.D.</a><a class="page-link" href="/abacus-canvas/search/">Search</a><a class="page-link" href="/abacus-canvas/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Merging Sensor Data Streams with Python Generators and Priority Queues</h1><p class="page-description">How I used Python generators to process streaming data from maritime sensors.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2016-03-19T00:00:00-05:00" itemprop="datePublished">
        Mar 19, 2016
      </time>• 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">Luca Cazzanti</span></span>
       • <span class="read-time" title="Estimated read time">
    
    
      12 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/abacus-canvas/categories/#sensors">sensors</a>
        &nbsp;
      
        <a class="category-tags-link" href="/abacus-canvas/categories/#streaming data">streaming data</a>
        &nbsp;
      
        <a class="category-tags-link" href="/abacus-canvas/categories/#Python generators">Python generators</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-justify-center">
          <div class="px-2">

    <a href="https://github.com/lucacazzanti/abacus-canvas/tree/master/_notebooks/2016-03-19-SensorDataStreamProcessing.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/abacus-canvas/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          
          <div class="px-2">
    <a href="https://colab.research.google.com/github/lucacazzanti/abacus-canvas/blob/master/_notebooks/2016-03-19-SensorDataStreamProcessing.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/abacus-canvas/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
          
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#Motivating-use-case:-Vessel-draft-as-a-proxy-for-loading/unloading-activity-in-ports">Motivating use case: Vessel draft as a proxy for loading/unloading activity in ports </a></li>
<li class="toc-entry toc-h2"><a href="#Approach">Approach </a></li>
<li class="toc-entry toc-h2"><a href="#Packages-and-helper-functions">Packages and helper functions </a></li>
<li class="toc-entry toc-h2"><a href="#Basic-scenario:-Two-sensors-and-one-vessel">Basic scenario: Two sensors and one vessel </a></li>
<li class="toc-entry toc-h2"><a href="#More-realistic-scenario---Two-sensors-and-multiple-vessels">More realistic scenario - Two sensors and multiple vessels </a></li>
<li class="toc-entry toc-h2"><a href="#Detecting-changes-in-streaming-sensor-data">Detecting changes in streaming sensor data </a></li>
<li class="toc-entry toc-h2"><a href="#Final-remarks:-scaling,-distributing,-batch-and-real-time-processing">Final remarks: scaling, distributing, batch and real-time processing </a>
<ul>
<li class="toc-entry toc-h4"><a href="#Further-reading">Further reading </a></li>
</ul>
</li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2016-03-19-SensorDataStreamProcessing.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A recurring task in multi-sensor data processing is merging -- or interleaving -- data from multiple sensors while maintaining chronological order.  For example, you may be combining temperature readings from different weather stations in a region, stringing together the locations of mobile devices recorded by different cell towers, or piecing together the routes taken by maritime vessels from the data they broadcast through the <a href="https://en.wikipedia.org/wiki/Automatic_Identification_System">Automatic Identification System (AIS)</a>.</p>
<p>Often, the volume of data recorded by each sensor is large compared to the available RAM; other times each sensor's data fits in memory, but the merged, sorted stream does not; yet other times the available RAM is insufficient even for smaller sensor data volumes because the merge-and-sort operation is carried out on a small, lightweight compute node (Raspberry Pi anyone?). For these reasons, maintaining order with the naive approach of concatenating-then-sorting-in-memory is infeasible. Fortunately, we can use Python generators, iterators, and priority queues from the Python package <a href="https://docs.python.org/2/library/heapq.html">heapq</a> to achieve ordered, merged data streams from multiple sensors with low memory overhead.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Motivating-use-case:-Vessel-draft-as-a-proxy-for-loading/unloading-activity-in-ports">
<a class="anchor" href="#Motivating-use-case:-Vessel-draft-as-a-proxy-for-loading/unloading-activity-in-ports" aria-hidden="true"><span class="octicon octicon-link"></span></a>Motivating use case: Vessel draft as a proxy for loading/unloading activity in ports<a class="anchor-link" href="#Motivating-use-case:-Vessel-draft-as-a-proxy-for-loading/unloading-activity-in-ports"> </a>
</h2>
<p><figure>
  
    <img class="docimage" src="/abacus-canvas/images/copied_from_nb/my_icons/draft_marks.jpg" alt="Draft marks picture from Wikipedia">
    
    
</figure>
</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Vessels periodically broadcast their <a href="https://en.wikipedia.org/wiki/Draft_%28hull%29">draft</a> -- the vertical distance between the waterline and the vessel's keel -- through the AIS protocol. Draft readings are used to ensure that loaded vessels to not run aground in shallower waters. Loading and unloading a vessel changes its draft, which can be used as an indicator of progress in port operations and as a proxy for maritime commerce. When multiple AIS data streams report the draft readings, we need to merge them into one unified stream to enable further vessel analytics, such as change detection.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Approach">
<a class="anchor" href="#Approach" aria-hidden="true"><span class="octicon octicon-link"></span></a>Approach<a class="anchor-link" href="#Approach"> </a>
</h2>
<p>In this post I assume that there are two AIS sensor networks and data from each are stored in two separte database tables. For simplicity I also assume there are only two vessels. AIS messages transmitted by the vessels are stored in the database tables in the order they arrive, along with a time stamp. In this post I use <a href="https://docs.python.org/2.7/library/sqlite3.html">sqlite3</a> to simulate this system and use synthetic datasets to illustrate the key points.</p>
<ul>
<li>To address the requirement to <strong>use little memory</strong>: use lazy evaluation and generators to iterate over the data streams to avoid creating intermediate data containers. In practice, this means iterating over database connection objects, not over the data in the database.</li>
<li>To address the requirement to <strong>keep sorted order</strong>: delegate sorting of the individual data streams to the database, then use the powerful <code>heapq.merge()</code> function to interleave the individual streams into one.</li>
</ul>
<p>These two techniques have been known to software developers for a long time, but they mey be new to scientists (like me) who do not have formal training in software engineering or databases, but need to analyze large data sets.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Packages-and-helper-functions">
<a class="anchor" href="#Packages-and-helper-functions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Packages and helper functions<a class="anchor-link" href="#Packages-and-helper-functions"> </a>
</h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">heapq</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">'ggplot'</span><span class="p">)</span>
<span class="o">%</span><span class="k">matplotlib</span> inline


<span class="k">def</span> <span class="nf">head_db</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Print the first n records from table_name</span>
<span class="sd">    """</span>
    <span class="n">query</span> <span class="o">=</span> <span class="s2">"SELECT * FROM </span><span class="si">%s</span><span class="s2"> LIMIT </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">'vessel_draft.sqlite'</span><span class="p">)</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
        <span class="nb">print</span> <span class="n">res</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    
<span class="k">def</span> <span class="nf">plot_timeseries</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Plot the time series of draft readings for one vessel.</span>
<span class="sd">    """</span>
    
    <span class="p">(</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">vessel_id</span><span class="p">,</span> <span class="n">draft</span><span class="p">)</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">data</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">draft</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Timestamp'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Draft'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Vessel ID = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">vessel_id</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">draft</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">draft</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span>

    
<span class="k">def</span> <span class="nf">plot_timeseries_from_tables</span><span class="p">(</span><span class="n">table_names</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Plot the time series of draft readings for one vessel from 2 sensors.</span>
<span class="sd">    """</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">'vessel_draft.sqlite'</span><span class="p">)</span>
    
    <span class="n">query</span> <span class="o">=</span> <span class="s2">"SELECT * FROM </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">table_names</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
    <span class="n">plot_timeseries</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="s1">'post'</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">'o'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'r'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">hold</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="n">query</span> <span class="o">=</span> <span class="s2">"SELECT * FROM </span><span class="si">%s</span><span class="s2"> "</span> <span class="o">%</span> <span class="p">(</span><span class="n">table_names</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
    <span class="n">plot_timeseries</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="s1">'post'</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">'o'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'b'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">'Sensor 1'</span><span class="p">,</span> <span class="s1">'Sensor 2'</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">'lower right'</span><span class="p">)</span>
    
    <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> 

    
<span class="k">def</span> <span class="nf">plot_multi_series</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Plot the time series of draft readings for 2 vessel from 2 sensors.</span>
<span class="sd">    """</span>
    
    <span class="n">vessel1</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="n">vessel2</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
    <span class="n">plot_timeseries</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="n">vessel1</span><span class="p">),</span> <span class="n">where</span><span class="o">=</span><span class="s1">'post'</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">'o'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'darkviolet'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
    <span class="n">plot_timeseries</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="n">vessel2</span><span class="p">),</span> <span class="n">where</span><span class="o">=</span><span class="s1">'post'</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">'o'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'darkviolet'</span><span class="p">)</span>
    
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Basic-scenario:-Two-sensors-and-one-vessel">
<a class="anchor" href="#Basic-scenario:-Two-sensors-and-one-vessel" aria-hidden="true"><span class="octicon octicon-link"></span></a>Basic scenario: Two sensors and one vessel<a class="anchor-link" href="#Basic-scenario:-Two-sensors-and-one-vessel"> </a>
</h2>
<p>Assume there are two sensors (two database files), each one recording the draft of a single vessel, the timestamp of the draft reading and the vessel <code>id</code>. When a new reading is available, each sensor appends the value and the timestamp to its assigned database table.  Below is an example of what the data sources might look like. Note that the timestamps recorded by one sensor need not match the timestamps of the other, because the sensors operate asynchronosuly and each one records only the data it observes. This can be seen in the plot: some draft readings are common to the two sensors (violet color), but each sensor has access to readings not available to the other (red and blue color)</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">head_db</span><span class="p">(</span><span class="s1">'sensor1_single_vessel'</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{'draft': 12.0, 'id': 1, 'time': 1}
{'draft': 12.0, 'id': 1, 'time': 2}
{'draft': 12.0, 'id': 1, 'time': 3}
{'draft': 12.0, 'id': 1, 'time': 6}
{'draft': 18.0, 'id': 1, 'time': 7}
{'draft': 18.0, 'id': 1, 'time': 8}
{'draft': 18.0, 'id': 1, 'time': 11}
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">head_db</span><span class="p">(</span><span class="s1">'sensor2_single_vessel'</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{'draft': 12.0, 'id': 1, 'time': 1}
{'draft': 12.0, 'id': 1, 'time': 3}
{'draft': 12.0, 'id': 1, 'time': 4}
{'draft': 12.0, 'id': 1, 'time': 6}
{'draft': 18.0, 'id': 1, 'time': 7}
{'draft': 18.0, 'id': 1, 'time': 8}
{'draft': 18.0, 'id': 1, 'time': 9}
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plot_timeseries_from_tables</span><span class="p">([</span><span class="s1">'sensor1_single_vessel'</span><span class="p">,</span> <span class="s1">'sensor2_single_vessel'</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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%0A">
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's join the draft readings from the two sensors into one time series ...</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">table_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'sensor1_single_vessel'</span><span class="p">,</span> <span class="s1">'sensor2_single_vessel'</span><span class="p">]</span>
<span class="n">queries</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"SELECT * FROM </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="n">table_name</span> <span class="k">for</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="n">table_names</span><span class="p">]</span>

<span class="c1"># Open one DB connection per table (sensor)</span>
<span class="n">conns</span> <span class="o">=</span> <span class="p">[</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">'vessel_draft.sqlite'</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">table_names</span><span class="p">))]</span>

<span class="n">params</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">conns</span><span class="p">,</span> <span class="n">queries</span><span class="p">)</span>    
<span class="n">readers</span> <span class="o">=</span> <span class="p">[</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span> <span class="ow">in</span> <span class="n">params</span><span class="p">]</span>
<span class="n">merged</span> <span class="o">=</span> <span class="n">heapq</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="o">*</span><span class="n">readers</span><span class="p">)</span>

<span class="n">plot_timeseries</span><span class="p">(</span><span class="n">merged</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="s1">'post'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'darkviolet'</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">'o'</span><span class="p">)</span>
    
<span class="k">for</span> <span class="n">conn</span> <span class="ow">in</span> <span class="n">conns</span><span class="p">:</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAYMAAAEhCAYAAACdsMz3AAAABHNCSVQICAgIfAhkiAAAAAlwSFlz%0AAAALEgAACxIB0t1+/AAAHVNJREFUeJzt3XuYHHWd7/H3D8IkBBqEZIUzuSmLeFYkCAcTWPUw6KO4%0AniwS3fkm4AEMihDEjZcQNfA4I5csjshuFlaCGAZBQ/jiYUCWoyIrLWQ1CYosoOi6CpmBOQRDuIwO%0AmSSkzh9VA51J96SnM13VPf15PU8/6br8ur7z6059ui5dFaIoQkREGtteWRcgIiLZUxiIiIjCQERE%0AFAYiIoLCQEREUBiIiAgKA5E9FkJ4IITw9azrENkTCgOpOSGEO0II60pMGx9C2BxCuCTtuioVQtg7%0AhLAjhGAF455Kxu0IIbwcQugJIdxVOE+VazoxhHBnCGFDUsOSNJYrtUthILXoG8BxIYSjikz7OyAH%0AXJ9uSaMuAi4FDgUOBz4M/BK4MYSwOoXl7w88CnwOeDaF5UmNUxhILfo+0AOcU2Tax4F7oijqAQgh%0AjAshXBpCeCKE0B9CeCSE8LHCBiGEc0MIjyffwDeFEH4cQjg0mXZgCOFbIYRnQghbQghPhhC+MqT9%0AohDCb5L2vwkhfCGEsPco/J1/jqLo2SiKno6iaH0URV8C5gEWQjhtFF6/pCiK7o6i6OIoir4LbKvm%0AsqQ+jMu6AJGhoiiKQggrgU+HEC6MomgAIITwJuBE4NSC2W8E3gKcDfwBmA1cF0LYGkXRzSGE2cDV%0AwJnAvwMHACcUtP8H4K3AHGAjMBX4q8GJIYTLgNOARcTfpN8CXAfsQ/zNflRFUXRXCOE3QCtwS7F5%0AQghvBB7ZzUv9VxRFx4x2fTJ2KQykVq0EvkS8Uvx2Mu7jQC/wrwAhhMOB04HDoyj6QzLPhhDCkcDf%0AAzcD04A+4K4oiv6czPOrguVMB34RRdHPk+Ee4GfJ6+8HfBaYE0XRjwtevw3ooAphUFDfm4aZ3g0c%0AvZvX2Dp65UgjUBhITYqiqDeEcDfxrqJvhxDGAWcB10VRtCOZ7bjk34dDCKGg+d7AluT5D4lX8E+G%0AEH4E/Bi4PYqizcn0fwFuCyHMAu4DfhBF0Q+TaUcBE4A7d3559gaaQggHRlH04ij9yYUC8TGFoqIo%0AeoV4K0hk1CgMpJZ9A7grhPBm4l05k4i3GAbtRbzSnA0MDGm7AyCKor4QwrHAO4H3AOcDHSGEliiK%0AHomi6PshhGnAyUALsCqE8BDwPl47pnYq8ESR+l7a8z+xqCOBX5eaWLCbKCIOjmK0m0hGRGEgtWzw%0AQPIniPfj3xNFUXfB9F8k/06LouieUi+SbEncnzzaQgi/JT4O8Egy/XlgNbA6hHAz8ABwBPExggHg%0AL6Mo+rfR/MNKCSGcArwZaB9mNu0mklGnMJCaVXAg+bPEp0J+eMj03yYr7xuS8+TXJvMdBxwURdHX%0AQghziY8bPABsAmYBzSTHDUIIy4B1xN/EA/AR4m/8PVEU9SdnFn0lhLAX8G/EB46PBo6KomjpHv6J%0A+4cQDiH+fzgFOCX5W2+NoujWYfplj3cTJcdDDif+m/cB/lsI4Wigr+D4izSSKIr00KNmH8Qr7q3E%0AWwh7FZm+F/B54HHi4wQbiY8LzE2mn5gMPwv0A78BPlfQvo14C6APeD6Zd/aQZXyc+DcALwPPAT8F%0AzimYfj/w9WH+hr2BVwArGNeTjHsled0e4HtAa0r9+h7iXWmvDHnck/V7rkc2j5B8MKrOzFaSnL7n%0A7jOTcTOBFcB+wJPAR9z9T6kUJCIir0rzR2edxAfpCn0TWOLuRwNdQNk/iTezltErbexQv+xKfVKc%0A+qW4Ru2X1MLA3dcQb4YXelMyHuBehuwT3o2W0ahrDGrJuoAa1JJ1ATWqJesCalRL1gVkIevLUfzK%0AzE5Jnhvxrz9FRCRlWYfB2cAnzexB4uMGOh1ORCQDqR1ABjCzGcBdgweQh0x7E3Czux9fom0LBZtv%0A7t5WpTJFRMY0M/tywWDe3fNp/84gUPCLSTP7C3f/o5ntBVxMfGZRUe6eB/IFo9p6e3urVGb9yuVy%0A9PX1ZV1GTVGfFKd+KW6s90tzczPu3j50fJqnlq4i/mY/ifhc8Dbi69J/kvhn9be7+0h+xBMpDHY1%0A1j/IlVCfFKd+KW6s90tzczMUuYxJalsG7n56iUn/nFYNIiJSXNYHkEVEpAYoDERERGEgIiIKAxER%0AQWEgIiIoDEREBIWBiIigMBARERQGIiKCwkBERFAYiIgICgMREUFhICIiKAxERASFgYiIoDAQEREU%0ABiIigsJARERQGIiICCneA9nMVgJzgI3uPjMZdzSwApgAbAPOd/efp1WTiIjE0twy6AROHjKuA2hz%0A92OANuCrKdYjIiKJ1LYM3H2Nmc0YMnoHcGDy/HXA02nVI3tm3dr1XLnoWnhpPBwwwOLlC5l9/Kyq%0Atevp7qGzYzX9z2xn4qHjWLBkPtOmTyurzdZNEU2TQ1ltKl3WnrQTqQWphUEJnwF+aGZfAwLw1xnX%0AI2VYt3Y9HfNupHX7pYxnIgMv9dMxbxlLbmXYFXul7Xq6e7h8/nW0bDgvbkc/lz+0gotWn1tyZVtJ%0AmyzaidSKrA8gLwQWuft04mC4IeN6pAxXLrqW1u1LGc9EAMYzkdbtS+Nv/FVo19mx+tWV7GC7lg3n%0A0dmxelTbZNFOpFZkvWVwlrsvAnD37yYHmYsysxagZXDY3cnlclUvsN40NTVVvV9C34RXV3qDxjOR%0AbU810TVlc8l222iqqF03WziqSLvuri10dRVvV0mbLNplafxBLzBvg7Zahkrj/1DWzKy9YDDv7vm0%0AwyAkj0FPm9mJ7v4TM3sP8J+lGrp7HsgXjGrr6+urSpH1LJfLUe1+iXJbGHixf6cV+wD97DN1K3PX%0AHVyy3arZWxl4auTtHr1gAgNdu7abPncCc68p3q6SNlm0y1LXlM1V/6zUozT+D2Upl8vh7u1Dx6e2%0Am8jMVgE/BY4ws24zWwCcA3zNzH4JXAZ8Iq16pHKLly/ktnHLGKAfiFd6t41bxuLlC6vSbsGS+eRn%0ArNipXX7GChYsmT+qbbJoJ1IrQhRFWddQqai3tzfrGmpOWt9qBs8K2vZUE/tM3Zra2UQvb9zOvoeM%0A9GwiaJrMiM8KGsmy9qRdVrqmbGbu07W51ZKlsb5l0NzcDDvvoQEUBmNO2h/kelihjPX/3JWqh/cu%0AC2P981IqDLI+m0hERGqAwkBERBQGIiKiMBARERQGIiKCwkBERFAYiIgICgMREUFhICIiKAxERASF%0AgYiIoDAQEREUBiIigsJARERQGIiICAoDERFBYSAiIigMREQEGJfWgsxsJTAH2OjuM5Nxq4EjklkO%0AAp5392PTqklERGKphQHQCVwN3DQ4wt3nDz43syuBF1KsR0REEqntJnL3NcDzw8xiwC0plSMiIgVq%0A4piBmb0LeMbdf591LSIijSjN3UTDOY3dbBWYWQvQMjjs7uRyuepWVYeamppS7pfNNf8+pN8n9aL2%0A37ssNMLnxczaCwbz7p7PPAzMbG/gQ8CwB47dPQ/kC0a19fX1Va+wOpXL5Ui7X2r9fciiT+qF+mVX%0AY/3zksvlcPf2oePT3k0Ukkeh9wKPu3tvyrWIiEgitTAws1XAT4EjzKzbzBYkk+ahA8ciIplKbTeR%0Au59eYvyCYuNFRCQ9NXE2kYiIZEthICIiCgMREVEYiIgICgMREUFhICIiKAxERASFgYiIoDAQEREU%0ABiIigsJARERQGIiICAoDERFBYSAiIigMREQEhYGIiKAwEBERFAYiIoLCQERESPEeyGa2EpgDbHT3%0AmQXjPwWcD2wH7nb3L6RVk4iIxNLcMugETi4cYWYtwN8CR7n7UcCVKdYjIiKJ1MLA3dcAzw8ZvRC4%0Awt23J/NsSqseERF5TWq7iUo4AvifZrYMeBm40N1/nnFNIiINJ+swGAcc5O7Hm9nbAQcOKzZjskup%0AZXDY3cnlcmnUWFeamppS7pfNNf8+pN8n9aL237ssNMLnxczaCwbz7p7POgx6gNsB3P1BM9thZpPc%0A/bmhM7p7HsgXjGrr6+tLpch6ksvlSLtfav19yKJP6oX6ZVdj/fOSy+Vw9/ah49M+tTQkj0F3AO8G%0AMLMjgH2KBYGIiFRXmqeWriLezTPJzLqBNuAGoNPMHgUGgDPTqkdERF6TWhi4++klJp2RVg0iIlKc%0AfoEsIiIKAxERURiIiAgKAxERQWEgIiIoDEREBIWBiIigMBARERQGIiKCwkBERFAYiIgIIwgDM1tc%0AYvxnR68cERHJwki2DL5UYvzFo1GIiIhkZ7dXLTWzdydP9zazk9j5fgSHAWP3LhAiIg2inEtYr0z+%0AnUB8/4FBEfAM8KnRLkpERNI1bBiY2dHu/sbk+U3urpvPiIiMQbs7ZvBAwfMTqlmIiIhkZ3e7iV4w%0AsznAr4FDzeyN7HzMAAB3/0M1ihMRkXTsLgwWAf8EzCDeivh9kXkiYO9RrktERFI0bBi4exfQBWBm%0Afe6eq3RBZrYSmANsdPeZybg24Bzg2WS2pe7+g0qXISIilSnnbKJBk/ZwWZ3A1cBNQ8Zf5e5X7eFr%0Ai0iZerp76OxYTTdbePSCCSxYMp9p06dVfXn9z2xn4qHjyl7eurXruXLRtfDSeDhggMXLFzL7+FlV%0Aa1epSv++SttVS9lh4O5bzewU4ERgMgXHDso5y8jd15jZjCKTdjkGISLV0dPdw+Xzr6Nlw3kcxUQG%0Auvq5/KEVXLT63KqsiAqXN56JDFDe8tatXU/HvBtp3X5p3O6lfjrmLWPJrQy7Yq+0Xdp/X6Xtqmkk%0Al6NoA65L2rQCzwEnAy/sYQ0XmNnDZvZNMztwD19LRIbR2bH61RUQwHgm0rLhPDo7VtfU8q5cdC2t%0A25fu1K51+9L4G38V2lWq0r8v7fehHCPZTXQ28F53f8zMFrj7Z8zsFvbschRfBy5x98jMLgOuAj5W%0AbEYzawFaBofdnVyu4kMYY1ZTU1PK/bK55t+H9Pukdm3dFL26Aho0nol0d22hq2vzqC+vmy0cVcHy%0AttFUtM5tTzXRNWX02+2s/H6o9O8r1W7rJlL5rJpZe8Fg3t3zIwmD17n7Y8nzrWa2j7uvN7MTKy3I%0A3f9YMHg9cNcw8+aBfMGotr4+XQljqFwuR9r9UuvvQxZ9UquaJgcG6N9phTlAP9PnTmDuNQeP+vIe%0AvWACA10jX96q2VsZeGrXdvtM3crcdaPfrtBIPi+V/n2l2jVNrv7/p1wuh7u3Dx0/kgvV/d7Mjkye%0APwYsNLMzgOdH8BqBgmMEZnZowbQPJa8rIlWyYMl88jNWMEA/EK+A8jNWsGDJ/Jpa3uLlC7lt3LKd%0A2t02bhmLly+sSrtKVfr3pf0+lCNEUVTWjGb2AeBP7n6/mc0CVgH7A+e7++1ltF9FvJtnErARaANO%0AAt4G7ACeBM51941l1h719vaWOWvjSPtbcNeUzcx9evS/UY4mbRnsbPAslq2boGkyqZ1N9PLG7ex7%0ASO2fTTTSz0ulf1+l7fZUc3MzFDlxp6wwMLO9iFfka9x962gXVyGFQREKg10pDIpTvxQ31vulVBiU%0AtZvI3XcAd9ZQEIiIyCgayTGD+83s+KpVIiIimRnJ2UQbgO+b2Z1AD/E1iQBw91J3QRMRkTowkjDY%0AF7gjeT61CrWIiEhGRhIGXwXeBRxM/KuMNe7+q6pUJSIiqSrnHsiB+NaXZwJPA73AFKDZzG4Gznb3%0A8s5PFRGRmlTOlsEniE8rPcHdHxwcaWZvB24BzgVWVKU6ERFJRTlnE50B/H1hEAAkw59OpouISB0r%0AJwzeAvykxLSfJNNFRKSOlRMGe7t70Z/jJeNH8lsFERGpQeUcM9jHzE6i9E1oRnJGkoiI1KByVuTP%0AAjfsZrqIiNSx3YaBu78hhTpERCRD2t8vIiIKAxERURiIiAgKAxERQWEgIiIoDEREhBR/MGZmK4E5%0AwEZ3nzlk2ueIL5E92d03p1WTiIjE0twy6AROHjrSzKYC7yW+k5qIiGQgtTBw9zXA80Um/SNwYVp1%0AiIjIrjI9ZmBmpwA97v5olnWIiDS6zC4yZ2b7AkuJdxENKnUxPMyshfgmOwC4O7lcrlrl1a2mpqaU%0A+2Vzzb8P6fdJfVC/FNcI/WJm7QWDeXfPhyhK746VZjYDuMvdZ5rZW4F7gX7iEJhKfFvNWe5ezsXv%0Aot7e3uoVW6dyuRx9fUWvOF4VXVM2M/fpg1NbXiXS7pN6oX4pbqz3S3NzMxT54p32lkEYLMLdHwMO%0AHZxgZk8Ax7p7seMKIiJSRakdMzCzVcBPgSPMrNvMFgyZJWKY3UQiIlI9qW0ZuPvpu5l+WFq1iIjI%0AzvQLZBERURiIiIjCQEREUBiIiAgKAxERQWEgIiIoDEREBIWBiIigMBARERQGIiKCwkBERFAYiIgI%0ACgMREUFhICIiKAxERASFgYiIoDAQEREUBiIigsJARERI8R7IZrYSmANsdPeZybhLgA8CO4CNwEfd%0A/Zm0ahIRkViaWwadwMlDxnW4+9HufgxwN9CWYj0iIpJILQzcfQ3w/JBxfyoY3I94C0FERFKW2m6i%0AUszsMuBM4AXgpIzLERFpSJmHgbtfDFxsZp8HPgW0F5vPzFqAloJ25HK5FCqsL01NTSn3y+aafx/S%0A75P6oH4prhH6xczaCwbz7p7PPAwKrAL+LyXCwN3zQL5gVFtfX1/Vi6o3uVyOtPul1t+HLPqkHqhf%0Aihvr/ZLL5XD39qHj0z61NCQPAMzs8IJppwKPp1yPiIiQ7qmlq4h380wys27iM4f+l5m9GXgF2ACc%0Al1Y9IiLymtTCwN1PLzK6M63li4hIafoFsoiIKAxERERhICIiKAxERASFgYiIoDAQEREUBiIigsJA%0ARERQGIiICAoDERFBYSAiIigMREQEhYGIiKAwEBERFAYiIoLCQEREUBiIiAgKAxERQWEgIiKkeA9k%0AM1sJzAE2uvvMZFwH8LfAAPB7YIG7v5RWTSIiEkstDIBO4GrgpoJx9wBfcPcdZnYF8MXkMerWrV3P%0AlYuuhZfGwwEDLF6+kNnHz9ptu57uHjo7VtP/zHYmHjqOBUvmM236tJpbXqUqrVNExpbUwsDd15jZ%0AjCHj7i0YXAt8uBrLXrd2PR3zbqR1+6WMZyIDL/XTMW8ZS25l2BVfT3cPl8+/jpYN58Xt6Ofyh1Zw%0A0epzh11Bp728SlVap4iMPbV0zOBs4PvVeOErF11L6/aljGciAOOZSOv2pfE34mF0dqx+dcU82K5l%0Aw3l0dqyuqeVVqtI6RWTsSXM3UUlmdhGwzd1XDTNPC9AyOOzu5HK5sl4/9E14dYU3aDwT2fZUE11T%0ANpds180WjirSrrtrC11dpdttoynV5e2s3Pkqr7NQ0+v2Kvt9yEpTU1PN15gF9UtxjdAvZtZeMJh3%0A93zmYWBmHwU+ALx7uPncPQ/kC0a19fX1lbWMKLeFgRf7d1rxDdDPPlO3MnfdwSXbPXrBBAa6dm03%0Afe4E5l5Tut2q2VsZeCq95RXK5XKU2y+V1jlUucvLykj6pJGoX4ob6/2Sy+Vw9/ah49PeTRSSBwBm%0A9n7gQuAUdx+o1kIXL1/IbeOWMUA/EK/wbhu3jMXLFw7bbsGS+eRnrNipXX7GChYsmV9Ty6tUpXWK%0AyNgToihKZUFmtop4N88kYCPQBiwFmoDnktnWuvv5Zb5k1NvbW/by9/Tsnpc3bmffQ9I7m2ikyxs0%0A0m81jXA20Vj/plcp9UtxY71fmpuboeBL+aDUwqAKRhQGjWKsf5AroT4pTv1S3Fjvl1JhUEtnE4mI%0ASEYUBiIiojAQERGFgYiIoDAQEREUBiIigsJARERQGIiICAoDERFBYSAiIigMREQEhYGIiKAwEBER%0AFAYiIoLCQEREUBiIiAgKAxERQWEgIiLAuLQWZGYrgTnARnefmYz7O6Ad+Cvg7e7+UFr1iIjIa9Lc%0AMugETh4y7lFgLvCTFOsQEZEhUgsDd18DPD9k3G/d/XcUuTmziIikR8cMREREYSAiIikeQN5TZtYC%0AtAwOuzvNzc2Z1VPLcrlc1iXUHPVJceqX4sZ6v5hZe8Fg3t3zRFGU2qO1tfUNra2tjxYZf19ra+v/%0AGOFrtadZe7081C/qE/WL+qWSR5qnlq4i/mY/ycy6gTbiA8pXA5OBfzWzh939b9KqSUREYqmFgbuf%0AXmLSHWnVICIixdXzAeR81gXUqHzWBdSgfNYF1Kh81gXUqHzWBWQhRFGUdQ0iIpKxet4yEBGRUaIw%0AEBGR+vmdwSAzez/wT8RBttLdv5JxSTXBzJ4EXgR2ANvcfVa2FWWjxAURDwJuBWYATwLm7i9mVmQG%0ASvRLG3AO8Gwy21J3/0FGJabOzKYCNwGHEP+/ud7d/7lRPy91tWVgZnsB1xBf8O5I4DQz++/ZVlUz%0AdgAt7n5MowZBotgFEb8A3OvubwZ+DHwx9aqyV6xfAK5y92OTR8MEQWI78Fl3PxI4Afhksj5pyM9L%0AXYUBMAv4nbtvcPdtwGrggxnXVCsC9fd+jrpiF0Qk/ox8K3n+LeDUVIuqASX6BRr4IpHu/oy7P5w8%0A/xPwODCVBv281NvKYwrQUzD8VDJOIAJ+ZGYPmtk5WRdTY17v7hshXgEAr8+4nlpygZk9bGbfNLMD%0Asy4mK2b2BuBtwFrgkEb8vNRbGEhp73D3Y4EPEG/uvjPrgmqYzqeOfR04zN3fBjwDXJVxPZkws/2B%0A7wKLki2EoZ+Phvi81FsYPA1MLxiemoxreO7+/5J//wh0Ee9Sk9hGMzsEwMwO5bUDpg3N3f/o7oMr%0AuuuBt2dZTxbMbBxxENzs7ncmoxvy81JvYfAgcLiZzTCzJmA+8L2Ma8qcmU1Mvt1gZvsB7wMey7aq%0ATAV23hf+PeCjyfOzgDuHNmgQO/VLsqIb9CEa8zNzA/Brd19eMK4hPy919wvk5NTS5bx2aukVGZeU%0AOTN7I/HWQER8uvB3GrVfCi+ICGwkviDiHcBtwDRgA/Gpgi9kVWMWSvTLScT7yXcQn0J57uC+8kZg%0AZu8A7ie+/W6UPJYC6wGnwT4vdRcGIiIy+uptN5GIiFSBwkBERBQGIiKiMBARERQGIiKCwkBERFAY%0ASAMxsy+a2TeyrkOkFul3BjJmmFkfr11HZj9gAHglGXeuu9+SQU2dQI+7fyntZYuMRN3d3EakFHfP%0ADT43sz8AH3P3+zIsSaRuKAxkrBp6faLBO3sd7u5nmNkM4AngbOAS4i2JpcAvgJXElyL4jrt/qqD9%0A2cBi4jtjrSfe2uhOpv0jcDowgfjSDqcB7wA+Auwws08D97n7B83s88R3GHs90A1c7O53JK9zVjJt%0APbAAeA44AzgCuBRoApa4+03J/J3AFuAvgeOT+s8arEukXDpmII1m6H7RWcDhwDzi26kuBd4NvBUw%0AM3sX8ZMPEt8B61TgL4AHgFuSae8D3kkcNAcCBjzn7tcD3wE63P0Adx+8EdN/EV9y/ADgy8C3B6+S%0AWVDTw8DByTJWA8cRr/DPAK4xs4kF85+evM4k4D+SZYqMiMJAGlkEXOLuW939XuDPwC3u/py79xKv%0A8I9J5j0X+Ad3/0933wFcAbzNzKYB24Ac8BYzC+7+2+Eu+Obu/6fg5im3Ab9j50uOP+HuNyWXl76V%0A+FLtX3b3be7+I2ArcYANutvd/z25+99FwAlmpps+yYhoN5E0usJr1b9MfEXPwuH9k+czgOVm9rVk%0AOBCHyRR3v8/MrgH+BZhuZrcDi5MbpezCzM4EPgO8IRm1HzC5YJahNeDum0rUBQV3/3P3P5vZZqAZ%0A3etDRkBhIFKeHuCyUmckufs1xLtvJhNfLvtC4stE77RbysymA98ATnL3nyXjfsme3Yt4WsHr70+8%0Ae6l3D15PGpDCQBrZSFbAK4BLzew/3P3Xyf2C3+vu3zWz44h3uT5E/K19C/E9AiD+ln9Ywevsl0zb%0AZGZ7Ed885a17WOcHzOyvgZ8TH2T+mbtrq0BGRMcMZKwq5wc0u7vX7avDydk+VwCrzewF4BHg/cnk%0AA4hvG7mZ+AylTcBXk2krgSPNbLOZ3e7ujxPfa3gt8X2HjwTW7GGdq4B24jOPjgH+925eT2QX+tGZ%0ASB3Tj9pktGjLQEREFAYidU6b9jIqtJtIRES0ZSAiIgoDERFBYSAiIigMREQEhYGIiKAwEBER4P8D%0A/+zEoFSdTxEAAAAASUVORK5CYII=%0A">
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Voila' a merged series of sensor readings, sorted by time!</p>
<p>Why does this work and why is this efficient? We rely on lazy evaluation: the <code>readers</code> list contains generators over the query results, and the <code>merged</code> result is itself a generator. <code>heapq.merge()</code> does not read the data in memory to sort it. Instead it creates only the internal data structures necessary to index the underlying data, and returns a generator. When one iterates over this generator, the order in which the items are yielded is the desired sorted order over the merged streams.</p>
<p>Let's take a look at the code in more detail.</p>
<ul>
<li>Lay out the parameters we will use and open one connection per table (sensor) to the database. We keep the connection objects in the list <code>conns</code>.</li>
</ul>
<div class="highlight"><pre><span></span><span class="n">table_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'sensor1_single_vessel'</span><span class="p">,</span> <span class="s1">'sensor2_single_vessel'</span><span class="p">]</span>
<span class="n">queries</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"SELECT * FROM </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="n">table_name</span> <span class="k">for</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="n">table_names</span><span class="p">]</span>

<span class="c1"># Open one DB connection per table (sensor)</span>
<span class="n">conns</span> <span class="o">=</span> <span class="p">[</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">'vessel_draft.sqlite'</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">table_names</span><span class="p">))]</span>
</pre></div>
<ul>
<li>Set up the queries. The <code>readers</code> list contains iterators over the query results, but the queries are not yet executed. Later, iterating over each <code>reader</code> object will yield a <code>sqlite3.Row</code> object from teh corresponding database table.<div class="highlight"><pre><span></span><span class="n">params</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">conns</span><span class="p">,</span> <span class="n">queries</span><span class="p">)</span>    
<span class="n">readers</span> <span class="o">=</span> <span class="p">[</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span> <span class="ow">in</span> <span class="n">params</span><span class="p">]</span>
</pre></div>
</li>
<li>Finally, merge the iterators over the data:<div class="highlight"><pre><span></span><span class="n">merged</span> <span class="o">=</span> <span class="n">heapq</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="o">*</span><span class="n">readers</span><span class="p">)</span>
</pre></div>
Note that <code>merged</code> is itself a generator, thus very little memory is used until it is consumed by the plot function. It is really this simple!</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="More-realistic-scenario---Two-sensors-and-multiple-vessels">
<a class="anchor" href="#More-realistic-scenario---Two-sensors-and-multiple-vessels" aria-hidden="true"><span class="octicon octicon-link"></span></a>More realistic scenario - Two sensors and multiple vessels<a class="anchor-link" href="#More-realistic-scenario---Two-sensors-and-multiple-vessels"> </a>
</h2>
<p>But wait, there are many vessels, not just one: A vessel draft data stream is more like the one below, where readings for different vessels may arrive at the same time and different vessel <code>id</code>s are interleaved:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">head_db</span><span class="p">(</span><span class="s1">'sensor1_multi_vessel'</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{'draft': 12.0, 'id': 1, 'time': 1}
{'draft': 5.0, 'id': 2, 'time': 1}
{'draft': 12.0, 'id': 1, 'time': 2}
{'draft': 7.0, 'id': 2, 'time': 2}
{'draft': 12.0, 'id': 1, 'time': 3}
{'draft': 7.0, 'id': 2, 'time': 3}
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This presents a complication: we want to maintain the chronological order of the sensor readings for each vessel, but the data are ordered globally by timestamp because each reading is recorded in the order it arrives, irrespective of the vessel. Feeding sensor tuples as they are to <code>heapq.merge()</code> will produce an undesired result. To address this problem we do the following:</p>
<ul>
<li>Group together the readings from the same vessels: we can do this simply by modifying the SQL query and use the <code>ORDER BY</code> contruct. This achieves vertical ordering of the readings from each sensor.</li>
<li>Re-order the tuple elements presented to <code>heapq.merge()</code> in the same way as the <code>ORDER BY</code> construct. We do this by declaring explicitly the order of the columns in the SQL <code>SELECT</code> statment. This ensures the correct horizontal ordering for the nested sorted index underlying <code>heapq.merge()</code>.</li>
</ul>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">table_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'sensor1_multi_vessel'</span><span class="p">,</span> <span class="s1">'sensor2_multi_vessel'</span><span class="p">]</span>
<span class="c1"># MODIFIED QUERY: nested order by id, time, draft and uses ORDER BY</span>
<span class="n">queries</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"SELECT id, time, draft FROM </span><span class="si">%s</span><span class="s2"> ORDER BY id, time"</span> <span class="o">%</span> <span class="n">table_name</span> <span class="k">for</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="n">table_names</span><span class="p">]</span>

<span class="c1"># Open one DB connection per table (sensor)</span>
<span class="n">conns</span> <span class="o">=</span> <span class="p">[</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">'vessel_draft.sqlite'</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">table_names</span><span class="p">))]</span>

<span class="n">params</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">conns</span><span class="p">,</span> <span class="n">queries</span><span class="p">)</span>    
<span class="n">readers</span> <span class="o">=</span> <span class="p">[</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span> <span class="ow">in</span> <span class="n">params</span><span class="p">]</span>
<span class="n">merged</span> <span class="o">=</span> <span class="n">heapq</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="o">*</span><span class="n">readers</span><span class="p">)</span>

<span class="c1"># Store in list for display</span>
<span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">merged</span><span class="p">)</span>
<span class="k">for</span> <span class="n">conn</span> <span class="ow">in</span> <span class="n">conns</span><span class="p">:</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span> <span class="s2">"(id, time, draft)"</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[:</span><span class="mi">10</span><span class="p">]:</span>
    <span class="nb">print</span> <span class="n">row</span>
<span class="nb">print</span> <span class="s2">"..."</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="mi">26</span><span class="p">:</span><span class="mi">36</span><span class="p">]:</span>
    <span class="nb">print</span> <span class="n">row</span>
<span class="n">plot_multi_series</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(id, time, draft)
(1, 1, 12.0)
(1, 1, 12.0)
(1, 2, 12.0)
(1, 3, 12.0)
(1, 3, 12.0)
(1, 4, 12.0)
(1, 6, 12.0)
(1, 6, 12.0)
(1, 7, 18.0)
(1, 7, 18.0)
...
(2, 1, 5.0)
(2, 2, 7.0)
(2, 2, 7.0)
(2, 3, 7.0)
(2, 3, 7.0)
(2, 4, 7.0)
(2, 4, 7.0)
(2, 5, 7.0)
(2, 6, 10.0)
(2, 7, 10.0)
</pre>
</div>
</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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%0AkiQJhjdwACAiVgAfmLrodtqynwfekZlnz/LccboOFWbm+gGFKanGIuIlXZMTmTkxxG3P2IdFxMeA%0AP5tt4ID9lyRYeP817N9JK+i6diMifiYzvx8RRwEvoj3Sc0adRCa6Zq3fuXPngMKsRqvVYs+eZv0E%0ATdNyalo+MFo5LV++nMzcUGEIh/RhMyybUZP7r1F6/8ylKbk0JQ9oVi6L6b+G+RMcm2l/kzyO9m/V%0ArAdawB/Svn3FezJzIT/+Vzalk5vSpDfjlKbl1LR8YLRyWr58OSz8Iv2+mKUPuwV4LXA88EPgi5n5%0Am/NYXWP6r1F6/8ylKbk0JQ9oVi6L6b+GdiQtM8+bZdHfDSsGSVqsw/Rh7x1qIJKOGFUPHJAkSdIM%0ALNIkSZJqyCJNkiSphizSJEmSasgiTZIkqYYs0iRJkmrIIk2SJKmGLNIkSZJqyCJNkiSphizSJEmS%0AasgiTZIkqYYs0iRJkmrIIk2SJKmGLNIkSZJqyCJNkiSphizSJEmSasgiTZIkqYYs0iRJkmrIIk2S%0AJKmGLNIkSZJqyCJNkiSphizSJEmSasgiTZIkqYYs0iRJkmrIIk2SJKmGLNIkSZJqyCJNkiSphizS%0AJEmSasgiTZIkqYYs0iRJkmrIIk2SJKmGLNIkSZJqyCJNkiSphpYMa0MRcQVwDrArM8/ozHswcDlw%0ALLAfeE5mfnZYMUmSJNXVMI+kbQIeP23eRmB9Zj4UWA/89RDjkSRJqq2hHUnLzKsjYsW02QeBe3T+%0Avidw47Diabpt11zLpWvfALcuhbtPctFlF3LW2Wcuuh3Aju072LRxC3tvOsCyE5ewZt1qTjn1lMO2%0A3XdzydjxxaxtB7V9SZJG3dCKtFn8CfCvEfFqoAB+qeJ4GmHbNdey8dy3serAy1jKMiZv3cvGcy9h%0A3ZUcUgDNtx20C6RXrH4j49df0G7LXl7x+ct54Zbz71QozbftoLYvSVITVD1w4EJgbWaeSrtge2vF%0A8TTCpWvfwKoDF7OUZQAsZRmrDlzcPmK1iHYAmzZuuaNAmmo7fv0FbNq4ZdFtB7V9SZKaoOojaU/P%0AzLUAmfnuzuCCGUXEODA+NZ2ZtFqtgQc4TGNjY33Jqdhz7B3FzJSlLGP/DWNsPWn3HfP2MzavdgDb%0AuY3TZ2i7fettbN26uLaD2v4gLb3XDzn3+mYduevX+25YImJD1+REZk5UFIokDdSwi7Si85hyY0Q8%0A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%0AkbSIeAbtYeu/Nke7ceY5OgrmP0JqO7dx+gzttm+9ja1bDx1JtZ+xvq/zULMvm++2p6tqxNcd22/Y%0AyJym5QOjl9NCR0dJ0qgadpFWdB4ARMRvAM8HfjUzJw/3xIWMjoL5j5C67rnHMrn1zu1OXXksK193%0A6EiqzWftY/KG/q6z2+FGscx32zOpcmRMk0bmQPPygdHKaTGjoyRpVA3tdGdEbAY+BZwWEdsjYg3w%0AWuButH+p+/MR8fp+bW++I6TWrFvNxIrLD2k3seJy1qxbPZR19jsfSZLUDEVZllXHsFjlzp07D9tg%0AoSMxf7LrAHc5ob+jO+ezzilzHdEYxdGdo3SUZj6alg+MVk7Lly+HrqPxI2zO/mtUjNL7Zy5NyaUp%0AeUCzcllM/9XoIm3UNOnNOKVpOTUtHxitnCzS6meU3j9zaUouTckDmpXLYvqvWozulCRJ0qEs0iRJ%0AkmrIIk2SJKmGLNIkSZJqyCJNkiSphizSJEmSasgiTZIkqYYs0iRJkmrIIk2SJKmGLNIkSZJqyCJN%0AkiSphizSJEmSasgiTZIkqYYs0iRJkmrIIk2SJKmGLNIkSZJqyCJNkiSphizSJEmSasgiTZIkqYYs%0A0iRJkmrIIk2SJKmGLNIkSZJqyCJNkiSphizSJEmSasgiTZIkqYYs0iRJkmrIIk2SJKmGLNIkSZJq%0AyCJNkiSphizSJEmSasgiTZIkqYYs0iRJkmpoybA2FBFXAOcAuzLzjM683wU2AA8EHpGZnx9WPJLU%0ALxFxFPBZ4IbMfGLV8UhqhmEeSdsEPH7avOuAlcDHhxiHJPXbWuCrVQchqVmGVqRl5tXALdPmfSMz%0AvwkUw4pDkvopIk4GngC8pepYJDWL16RJUm/+Bng+UFYdiKRmsUiTpEWKiN+ifZ3tF2mfEfCsgKS+%0AGdrAgV5FxDgwPjWdmSxfvryyeAal1WpVHULfNS2npuUDo5VTRGzompzIzImKQgF4FPDEiHgCcBeg%0AFRFvz8yndTdqev81Su+fuTQll6bkAc3KZcH9V1mWQ3usWrXqPqtWrbpuhvkfW7Vq1X9b4Lo2DDP2%0AIb0+5lTzR9PyaWpOFb2Oj161atX7j7TX3Fzq92hKHuZSDvUnODbT/iZ5XERsB9bTHkjwWuB44H9H%0AxBcz8zeHFZMkSVJdDa1Iy8zzZln03mHFIEmDkpkfx58TktRHozxwYKLqAAZgouoABmCi6gD6bKLq%0A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%0A">
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>There it is, a merged stream where the sensor readings for each vessel are ordered by time, and the corresponding plots.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Detecting-changes-in-streaming-sensor-data">
<a class="anchor" href="#Detecting-changes-in-streaming-sensor-data" aria-hidden="true"><span class="octicon octicon-link"></span></a>Detecting changes in streaming sensor data<a class="anchor-link" href="#Detecting-changes-in-streaming-sensor-data"> </a>
</h2>
<p>Tipically we are interested in changes in vessel draft, not in the entire sequence of readings, because draft changes slowly compared to the sampling period of the sensor and because changes in values and the time at which they occur carry the key information about port activities and vessel behavior. Furthermore, different sensors may report redundant readings (same value, same timestamp, same vessel id) that we should filter out. We can easily filter out the redundant information and the readings for which the draft has not changed with the powerful <code>unique_justseen</code> recipe, which filters an iterable, keeping an element only if it differs from the previous one. In keeping with our goal of lazy computing, it returns an iterator over the filtered sequence, not the actual data.</p>
<p>I downloaded all the recipes available on the <a href="https://docs.python.org/2/library/itertools.html">itertools doc page</a> and put them in a module called <code>itertools_recipes</code>. I use the recipes often, as below:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">itertools_recipes</span> <span class="kn">import</span> <span class="n">unique_justseen</span>
<span class="n">table_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'sensor1_multi_vessel'</span><span class="p">,</span> <span class="s1">'sensor2_multi_vessel'</span><span class="p">]</span>
<span class="n">queries</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"SELECT id, time, draft FROM </span><span class="si">%s</span><span class="s2"> ORDER BY id, time"</span> <span class="o">%</span> <span class="n">table_name</span> <span class="k">for</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="n">table_names</span><span class="p">]</span>

<span class="c1"># Open one DB connection per table (sensor)</span>
<span class="n">conns</span> <span class="o">=</span> <span class="p">[</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">'vessel_draft.sqlite'</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">table_names</span><span class="p">))]</span>

<span class="n">params</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">conns</span><span class="p">,</span> <span class="n">queries</span><span class="p">)</span>    
<span class="n">readers</span> <span class="o">=</span> <span class="p">[</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span> <span class="ow">in</span> <span class="n">params</span><span class="p">]</span>
<span class="n">merged</span> <span class="o">=</span> <span class="n">heapq</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="o">*</span><span class="n">readers</span><span class="p">)</span>

<span class="c1"># THIS IS IT -&gt; Change detection</span>
<span class="n">change_points</span> <span class="o">=</span> <span class="n">unique_justseen</span><span class="p">(</span><span class="n">merged</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>


<span class="n">change_pts_result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">change_points</span><span class="p">)</span>

<span class="k">for</span> <span class="n">conn</span> <span class="ow">in</span> <span class="n">conns</span><span class="p">:</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
<span class="nb">print</span> <span class="s2">"(id, time, draft)"</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">change_pts_result</span><span class="p">:</span>
    <span class="nb">print</span> <span class="n">row</span>
    
<span class="n">plot_multi_series</span><span class="p">(</span><span class="n">change_pts_result</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(id, time, draft)
(1, 1, 12.0)
(1, 7, 18.0)
(1, 15, 15.0)
(2, 1, 5.0)
(2, 2, 7.0)
(2, 6, 10.0)
(2, 16, 7.0)
</pre>
</div>
</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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%0Adcfp2VWYmRuGlKakFouIV/Y8nczMyRpjz1rDIuLDwMvnGjhg/ZIEC69fdV8nraDn3I2I+InM/G5E%0AHAC8gmqk56y6L2SyZ9KGW2+9dUhpzq3T6bBzZ/2XiWki7nJ6rcYdjbjHHHMMmblxsBktyP1q2Czz%0AZtV0/VoO9cN4ox2viZh1x1tM/aqtSYuIq6m+SR4REVuprj/TiYjfprp9xbsz86/qykeSFmKOGnYH%0A8CbgSOAfIuLzmfkrzWUpaSmprUnLzHPnmPXGunKQpMXaRw17T62JSFo2mh44IEmSpFnYpEmSJLWQ%0ATZokSVIL2aRJkiS1kE2aJElSC9mkSZIktZBNmiRJUgvZpEmSJLWQTZokSVIL2aRJkiS1kE2aJElS%0AC9mkSZIktZBNmiRJUgvZpEmSJLWQTZokSVIL2aRJkiS1kE2aJElSC9mkSZIktZBNmiRJUgvZpEmS%0AJLWQTZokSVIL2aRJkiS1kE2aJElSC9mkSZIktZBNmiRJUgvZpEmSJLWQTZokSVIL2aRJkiS1kE2a%0AJElSC9mkSZIktZBNmiRJUgvZpEmSJLWQTZokSVILragrUERcBZwJbMvMk7rTTgauBA4B7gZekpmf%0AqSsnSZKktqpzT9oEcMaMaZuADZn5WGAD8Loa85EkSWqt2vakZeb1EbFmxuS9wGHdxw8GbqkrHw3H%0A1NYpJjZtZtdt97Dy6BWsW7+WVatXNZ2WJEkjp7YmbQ4vA/4lIl4PFMDPN5yP+jC1dYrL176Z8Zsv%0A4GBWsptdXH7DlVy6+XwbNUmSFqjpgQMvBi7MzNVUDdvbG85HfZjYtPm+Bg3gYFYyfvMFTGza3HBm%0AkiSNnqb3pD0vMy8EyMxru4MLZhUR48D49PPMpNPpDD3BmcbGxpZN3IXG3LO9vK9Bm3YwK9m65S62%0AbNmxgMgLWXaQjDtfYw8+gLVbF7d3tN+/5YjY2PN0MjMnF70xSWqxupu0ovsz7ZaIOC0zr4uI04Gv%0Az7VitxBP9kzasHPnzqEkuS+dToflEnehMceOLNjNrvs1arvZxeqzD+HsKx4ytLiDYtz52/KwHYte%0At5+4nU6HzNy4qJX7NMcI9cOBdwFrgG8DkZnfbyI/SUtPbYc7I+Jq4GPA8RGxNSLWAS8CXh8RnwNe%0ADfxWXflo8NatX8vkmivZzS6gatAm11zJuvVrG85MGojZRqhfDHwwMx8FfAj4o9qzkrRk1Tm689w5%0AZp1aVw4arlWrV3Hp5vOZ2HQNW7fcxeqzD+HS9Q4a0NIwxwj1ZwCndR//NdXe/ovrzGu5mx5Rvmd7%0AydiRhSPKtaQ0fU6alphVq1dx2RUXsWXLjgUd4pRG1EMzcxtAZt4WEQ9tOqHlxBHlWuqaHt0pSUtJ%0A2XQCy4kjyrXUuSdNkhZvW0QclZnbIuJo4PbZFmp6dPoojA5fjMGNKF+MukdlL/V49cc8+PA7edbN%0A9e5xXejodJs0SZq/mSPU/x54PvBa4HnAe2dbqenR6aMwOnwxBjWifDHqfk+XerwmYvYzSn0xFjM6%0A3cOdkjQPc4xQfw3wtIj4GnB697lq4ohyLXXuSZOkedjHCPVfrDUR3ccR5VrqbNIkSSPLEeVayjzc%0AKUmS1EI2aZIkSS1kkyZJktRCNmmSJEktZJMmSZLUQjZpkiRJLWSTJkmS1EI2aZIkSS1kkyZJktRC%0ANmmSJEktZJMmSZLUQjZpkiRJLWSTJkmS1EI2aZIkSS1kkyZJktRCNmmSJEktZJMmSZLUQjZpkiRJ%0ALWSTJkmS1EI2aZIkSS1kkyZJktRCNmmSJEktZJMmSZLUQjZpkiRJLWSTJkmS1EI2aZIkSS20oq5A%0AEXEVcCawLTNP6k7bDBzfXeRw4I7MPKWunCRJktqqtiYNmADeBLxjekJmrp1+HBF/AtxZYz6SJEmt%0AVdvhzsy8HrhjH4sEcE1N6UiSJLVaK85Ji4gnAbdl5jebzkWSJKkNWtGkAc/GvWiSJEn3qfOctFlF%0AxIHAfwP2OWAgIsaB8ennmUmn0xlqbrMZGxtbNnH7i7lj0esup/d4dOM29/uNiI09Tyczc3LRG5Ok%0AFqu7SSu6P72eBnwlM2/d14rdQjzZM2nDzp07B5rcfHQ6HZZL3H5jLnbd5fQej3LcJn6/nU6HzNy4%0AqJUlacTUdrgzIq4GPgYcHxFbI2Jdd9az8FCnJEnS/dS2Jy0zz51j+rrZpkuSJC1nbRk4IEmSpB42%0AaZIkSS1kkyZJktRCjV+CQ5JGXURcCLyw+/StmfnGJvORtDS4J02S+hARJwAvAE4FHgOcGRGPbDYr%0ASUuBTZok9efRwCczc3dm3gt8hOoC3ZLUFw93SlJ/vgS8OiIOB3YDTwc+3WxKkpYC96RJUh8y86vA%0Aa4F/Bf4R+Bxwb6NJSVoS3JMmSX3KzAlgAiAiLgemeuc3fe/h0bv372Is/n6yi1H361vq8ZqJWe/f%0ADCz83sM2aZLUp4j4icz8bkSsBs4GHt87v+l7D4/ivX8XYym/p0s9XlMx635PF3rvYZs0Serf/4qI%0AhwB3Ay/JzB80nZCk0WeTJkl9yswnN52DpKXHgQOSJEktZJMmSZLUQjZpkiRJLWSTJkmS1EI2aZIk%0ASS1kkyZJktRCNmmSJEktZJMmSZLUQjZpkiRJLWSTJkmS1EI2aZIkSS1kkyZJktRCNmmSJEktZJMm%0ASZLUQjZpkiRJLWSTJkmS1EI2aZIkSS1kkyZJktRCNmmSJEktZJMmSZLUQjZpkiRJLbSirkARcRVw%0AJrAtM0/qmf5S4CXAPcD7M/PiunKSJElqqzr3pE0AZ/ROiIhx4NeAEzPzROBPasxHkiSptWpr0jLz%0AeuCOGZNfDLwmM+/pLrO9rnwkSZLarLbDnXM4HnhyRPwP4EfARZn5mYZzkiRJalzTAwdWAIdn5uOB%0A9UA2nI8kSVIrNL0nbQp4N0Bmfjoi9kbEEZn5vZkLds9fG59+npl0Op268rzP2NjYsonbX8wdi153%0AOb3Hoxu3ud9vRGzseTqZmZOL3pgktVjdTVrR/Zn2HuCpwHURcTxw0GwNGkC3EE/2TNqwc+fOIaU5%0At06nw3KJ22/Mxa67nN7jUY7bxO+30+mQmRsXtbIkjZg6L8FxNdWesCMiYiuwAXg7MBERNwK7gefW%0AlY8kSVKb1dakZea5c8x6Tl05SJIkjYqmBw5IkiRpFjZpkiRJLWSTJkmS1EI2aZIkSS1kkyZJktRC%0ANmmSJEktZJMmSZLUQjZpkiRJLWSTJkmS1EJN32BdkkZeRLwMeAGwF7gRWJeZe5rNStKoc0+aJPUh%0AIo4BXgqckpknUX35XdtsVpKWAvekSVL/DgQOjYi9wErg1obzkbQEuCdNkvqQmbcCrwe2ArcAd2bm%0AB5vNStJS4J40SepDRDwYeAawBvg+cG1EnJuZV/csMw6MTz/PTDqdTm05jo2N1RqvmZg7lvR7utTj%0ANROz3r8ZgIjY2PN0MjMn97W8TZok9ecXgZsycwdARLwb+HngviatW4gne9bZsHPnztoS7HQ61Bmv%0AqZhL+T1d6vGailn3e5qZGxeyjk2aJPVnK/D4iDgE2A2cDny62ZQkLQWekyZJfcjMTwHXAp8DvgAU%0AwFsaTUrSkuCeNEnqU2a+Enhl03lIWlrckyZJktRCNmmSJEktZJMmSZLUQjZpkiRJLWSTJkmS1EI2%0A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%0A9pkLR8Q4MD79PDPpdDr1ZNpjbGxs2cTtL+aORa+7nN5j4y5cRGzseTqZmZP95iRJbVR3k1Z0f8jM%0ALwFHT8+IiG8Bp2TmbOet0S3Ekz2TNuzcuXNoic6l0+mwXOL2G3Ox6y6n99i4C183MzcONiNJaqfa%0AzkmLiKuBjwHHR8TWiFg3Y5ESD3dKkiQBNe5Jy8xz9zP/kXXlIkmS1HbecUCSJKmFbNIkSZJayCZN%0AkiSphWzSJEmSWsgmTZIkqYVs0iRJklrIJk2SJKmFbNIkSZJayCZNkiSphWzSJEmSWsgmTZIkqYVs%0A0iRJklrIJk2SJKmFbNIkSZJayCZNkiSphWzSJEmSWsgmTZIkqYVs0iRJklrIJk2SJKmFbNIkSZJa%0AyCZNkiSphVY0nYAkjbqIOAx4G/AzwF7gvMz8ZLNZSRp17kmTpP69AfjHzHw0cDLwlYbzkbQEuCdN%0AkvoQEQ8CnpSZzwfIzHuAHzSalKQlwSZNkvrzCGB7RExQ7UX7DHBhZv6o2bQkjToPd0pSf1YApwB/%0AkZmnALuAi5tNSdJS4J40SerPd4CpzPxM9/m1wB/2LhAR48D49PPMpNPp1JUfsKPmeDA2NlZrTOON%0AdrwmYjbxGiNiY8/Tycyc3NfyNmmS1IfM3BYRUxFxfGZ+HTgd+PKMZSaByZ5JG3bu3FlfkkDd8Tqd%0ATq0xjTfa8ZqI2US8zNy4kHVs0iSpf78L/G1EHATcBKxrOB9JS4BNmiT1KTO/APxs03lIWlocOCBJ%0AktRCNmmSJEktZJMmSZLUQrWdkxYRVwFnAtsy86TutFcBz6C619024PmZeVtdOUmSJLVVnXvSJoAz%0AZkzblJknZ+ZjgfcDG2rMR5IkqbVqa9Iy83rgjhnTftjz9FCqPWqSJEnLXuOX4IiIVwPPBe4EntJw%0AOpIkSa3Q+MCBzHxFZq4G/hZ4adP5SJIktUHje9J6XA38I7BxtpnN3/uu0sS9vpqK21/Mxd8rcDm9%0Ax8ZduIXe+06SRlXdTVrR/QEgIo7LzH/vPn0m8JW5VmzDve+gmfuZNRW335iLXXc5vcfGXfi6C733%0AnSSNqjovwXE11Z6wIyJiK9VIzl+NiEcB9wI3AxfUlY8kSVKb1dakZea5s0yeqCu+JEnSKGl84IAk%0ASZL+M5s0SZKkFrJJkyRJaiGbNEmSpBaySZMkSWohmzRJkqQWskmTJElqIZs0SZKkFrJJkyRJaiGb%0ANEmSpBaySZMkSWohmzRJkqQWskmTJElqIZs0SZKkFrJJkyRJaiGbNEmSpBaySZMkSWohmzRJkqQW%0AskmTJElqIZs0SZKkFrJJkyRJaiGbNEmSpBaySZMkSWohmzRJkqQWskmTJElqIZs0SZKkFrJJkyRJ%0AaqEVTScgSaMuIr4NfB/YC9ydmY9rNiNJS4FNmiT1by8wnpl3NJ2IpKXDJk2S+lcwxNNHprZOMbFp%0AM7tuu4eVR69g3fq1rFq9aljhJLWETZok9a8E/jUi7gXekplvHdSGp7ZOcfnaNzN+8wUczEp2s4vL%0Ab7iSSzefb6MmLXEOHJCk/j0xM08Bng78dkT8wqA2PLFp830NGsDBrGT85guY2LR5UCEktZR70iSp%0AT5n5f7v/fjcitgCPA66fnh8R48B4z/J0Op15bXvP9vK+Bm3awaxk65a72LJlx7y2cfDhB8w73qCM%0AjY3VGtN4ox2viZhNvMaI2NjzdDIzJ/e1fG1NWkRcBZwJbMvMk7rTNgG/BuwGvgmsy8wf1JWTJPUr%0AIlYCB2TmDyPiUOCXgFf2LtMtxJM9kzbs3LlzXtsfO7JgN7vu16jtZherzz6Es694yLy20el0mG+8%0AQak7pvFGO14TMZuIl5kbF7JOnYc7J4AzZkz7AHBCZj4G+AbwRzXmI0mDcBRwfUR8DvgE8L7M/MCg%0ANr5u/Vom11zJbnYBVYM2ueZK1q1fO6gQklqqtj1pmXl9RKyZMe2DPU8/Afz6MHNwhJSkQcvMbwGP%0AGdb2V61exaWbz2di0zX8aNs9POCoFVy63kED0nLQpnPSzgOGdiasI6QkjapVq1dx2RUXNZ2GpJq1%0AYnRnRFxKdZXuq4cVwxFSkiRplDS+Jy0ink81bP2p+1lunEWOjoLBjJCqLGTZQWoi7uJjjj148aPJ%0AmhhxY9zRibvQ0VGSNKrqbtKK7g8AEfHLwEXAkzNz975W7Gd0FAxmhBQ0M+Klqbj9xlzsusvpPTbu%0Awtdd6OgoSRpVtR3ujIirgY8Bx0fE1ohYB7wJeCDVlbpviIi/HFZ8R0hJkqRRUufoznNnmTxRV3xH%0ASEmSpFHS+DlpdXKElCRJGhWtGN0pSZKk+7NJkyRJaiGbNEmSpBaySZMkSWohmzRJkqQWskmTJElq%0AIZs0SZKkFrJJkyRJaiGbNEmSpBaySZMkSWohmzRJkqQWskmTJElqIZs0SZKkFrJJkyRJaiGbNEmS%0A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%0AFvp/NH9ltyd29UQAAAAASUVORK5CYII=%0A">
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And here they are, merged, parsimonious time series that capture when the draft changes, for two vessel, from two different sensors.</p>
<p>Note that I specified a key for <code>unique_everseen</code> to understand which part of the tuples to use for the queality comparison: I want to determine uniqueness only by the vessel id and draft values (tuple elements 0 and 2). Since the tuples are ordered by time, this results in sorted stream with duplicated draft readings for each vessel filtered out.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Final-remarks:-scaling,-distributing,-batch-and-real-time-processing">
<a class="anchor" href="#Final-remarks:-scaling,-distributing,-batch-and-real-time-processing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Final remarks: scaling, distributing, batch and real-time processing<a class="anchor-link" href="#Final-remarks:-scaling,-distributing,-batch-and-real-time-processing"> </a>
</h2>
<p>Don't let the simplicity of this approach fool you. It is a powerful way to combine many sources of data on small-ish compute nodes and a fundamental building block for more sophisticated analyses. In my work I use versions of it to process  $\approx$ 500 million AIS messages from 2-5 sources of AIS data from a SQL Server every month. On my HortonWorks VM running on a quad-core Intel processor, this takes approximately 15 minutes and a small blip in memory usage. It is a perfect match for batch processing of slowly-changing attributes in large datasets and it has been a huge helper for me when I need to prepare data for machine learning algorithms and visualizations.</p>
<p>I deal mostly with historical analyses of data, for which higher latency is acceptable and the entire data over the period of analysis is available. Therefore, delegating the initial sorting and row ordering of the individual streams to the database is feasible and indeed desirable. This approach can be extended to geographically distributed data sources, for example to a scenario where data from hundreds of storage-capable AIS receivers provide the data streams for periodic merging.</p>
<p>I used the term <em>stream</em> to indicate that the data are read in sequence; it is not to be confused with real-time. If you need to merge and sort in real time, then you may need to read small buffers from the data sources in memory and perform the sorting and merging on each buffer within the Python program, accepting that you may obtain only approximate results on time windows larger than the buffer size: speed costs accuracy. Of course, then other frameworks, like <a href="http://storm.apache.org/">Storm</a> and <a href="http://spark.apache.org/streaming/">SparkStreaming</a> may be more appropriate, and you may also consider <a href="http://lambda-architecture.net/">Lambda Architecture</a> in your system design.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Further-reading">
<a class="anchor" href="#Further-reading" aria-hidden="true"><span class="octicon octicon-link"></span></a>Further reading<a class="anchor-link" href="#Further-reading"> </a>
</h4>
<ul>
<li>
<a href="http://neopythonic.blogspot.it/2008/10/sorting-million-32-bit-integers-in-2mb.html">Sorting 1M 32-bit integers in 2 MB of RAM using Python</a>, by Guido van Rossum</li>
<li>Let your mind be blown by <a href="http://www.dabeaz.com">Dave Beazley's</a> PyCon presentation on <a href="http://www.dabeaz.com/finalgenerator/index.html">Python generators</a>.</li>
<li>Background on <a href="https://en.wikipedia.org/wiki/Automatic_Identification_System">AIS</a>
</li>
<li>
<a href="https://en.wikipedia.org/wiki/Binary_heap">Binary heap on Wikipedia</a>, the data structure that enables the magic in <code>heapq.merge()</code>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>License</strong>
You may use and modify this Jupyter notebook under the terms of the <a href="https://opensource.org/licenses">BSD license</a>. Download the the <a href="/abacus-canvas/downloads/vessel_draft.sqlite">supporting sqlite database</a>.</p>

</div>
</div>
</div>
</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="lucacazzanti/abacus-canvas"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/abacus-canvas/sensors/streaming%20data/python%20generators/2016/03/19/SensorDataStreamProcessing.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/abacus-canvas/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/abacus-canvas/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/abacus-canvas/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Luca Cazzanti&#39;s data science blog.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/lucacazzanti" target="_blank" title="lucacazzanti"><svg class="svg-icon grey"><use xlink:href="/abacus-canvas/assets/minima-social-icons.svg#github"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
